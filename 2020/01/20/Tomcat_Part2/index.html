<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="JJMJ's blog."><meta name="keywords" content="Java, Spring, MyBatis, 后端"><link rel="stylesheet" type="text/css" href="//fonts.loli.net/css?family=Source+Code+Pro"><link rel="stylesheet" type="text/css" href="/css/style.css?v=2.0.4"><link rel="stylesheet" type="text/css" href="/css/highlight.css?v=2.0.4"><link rel="Shortcut Icon" href="/favicon.ico"><link rel="bookmark" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><title>Tomcat | 掘金木匠</title><meta name="generator" content="Hexo 4.2.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Tomcat</h1><a id="logo" href="/.">掘金木匠</a><p class="description">懂金融的软件工程师一定是一个合格的吃货</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div><div id="search-form"><div id="result-mask" class="hide"></div><label><input id="search-key" type="text" autocomplete="off" placeholder="搜索"></label><div id="result-wrap" class="hide"><div id="search-result"></div></div><div class="hide"><template id="search-tpl"><div class="item"><a href="/{path}" title="{title}"><div class="title">{title}</div><div class="time">{date}</div><div class="tags">{tags}</div></a></div></template></div></div></div><div id="layout" class="layout-g"><div class="layout-l"><div class="content_container"><div class="post"><h1 class="post-title">Tomcat</h1><div class="post-meta"><a href="/2020/01/20/Tomcat_Part2/#comments" class="comment-count"><i id="changyan_count_unit" data-xid="2020/01/20/Tomcat_Part2/"></i>留言,<i id="changyan_parti_unit" data-xid="2020/01/20/Tomcat_Part2/"></i>参与</a><p><span class="date">Jan 20, 2020</span><span><a href="/categories/Web%E5%BC%80%E5%8F%91/" class="category">Web开发</a></span><span><i id="busuanzi_container_page_pv"><i id="busuanzi_value_page_pv"></i><i>点击</i></i></span></p></div><div class="post-content"><h1 id="Tomcat"><a href="#Tomcat" class="headerlink" title="Tomcat"></a>Tomcat</h1><h2 id="4-Tomcat服务器配置"><a href="#4-Tomcat服务器配置" class="headerlink" title="4. Tomcat服务器配置"></a>4. Tomcat服务器配置</h2><h3 id="4-1-server-xml"><a href="#4-1-server-xml" class="headerlink" title="4.1.server.xml"></a>4.1.server.xml</h3><ul>
<li>server.xml是tomcat服务器的核心配置文件。包含了Tomcat的servlet容器( Catalina )的所有配置</li>
</ul>
<h4 id="4-1-1-Server"><a href="#4-1-1-Server" class="headerlink" title="4.1.1.Server"></a>4.1.1.Server</h4><ul>
<li><code>Server</code>是server.xml的根元素。用于创建一个Server实例，默认使用的实现类是<code>org.apache.catalina.core.Standardserver</code></li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Server</span> <span class="attr">port</span>=<span class="string">"8005"</span> <span class="attr">shutdown</span>=<span class="string">"SHUTDOWN"</span>&gt;</span></span><br><span class="line">	...</span><br><span class="line"><span class="tag">&lt;/<span class="name">Server</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>port : Tomcat 监听的关闭服务器的端口。<br>shutdown:关闭服务器的指令字符串。</p>
<ul>
<li><p>Server内嵌的子元素为Listener, GlobaINamingResources，Service</p>
<ul>
<li>Listener</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># 用于以日志形式输出服务器 操作系统 JVM的版本信息</span><br><span class="line"><span class="tag">&lt;<span class="name">Listener</span> <span class="attr">className</span>=<span class="string">"org.apache.catalina.startup.VersionLoggerListener"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"># 用于加载(服务器启动)和销毁(服务器停止) APP如果找不到APP库 则会输出日志，并不影响Tomcat启动 </span><br><span class="line"><span class="tag">&lt;<span class="name">Listener</span> <span class="attr">className</span>=<span class="string">"org.apache.catalina.core.AprLifecycleListener"</span> <span class="attr">SSLEngine</span>=<span class="string">"on"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"># 用于避免JRE内存泄漏问题</span><br><span class="line"><span class="tag">&lt;<span class="name">Listener</span> <span class="attr">className</span>=<span class="string">"org.apache.catalina.core.JreMemoryLeakPreventionListener"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"># 用户加载(服务器启动)和销照(服务器停止) 全局命名服务</span><br><span class="line"><span class="tag">&lt;<span class="name">Listener</span> <span class="attr">className</span>=<span class="string">"org.apache.catalina.mbeans.GlobalResourcesLifecycleListener"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"># 用于在Context停止时重建Executor池中的线程，以避免Threedlocal 相关的内存泄漏</span><br><span class="line"><span class="tag">&lt;<span class="name">Listener</span> <span class="attr">className</span>=<span class="string">"org.apache.catalina.core.ThreadLocalLeakPreventionListener"</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>GlobalNamingResources中定义了全局命名服务</p>
</li>
<li><p>Service：一个server服务器.可以包含多个service服务</p>
</li>
</ul>
</li>
</ul>
<h4 id="4-1-2-Service"><a href="#4-1-2-Service" class="headerlink" title="4.1.2.Service"></a>4.1.2.Service</h4><ul>
<li>该元素用于创建<code>service</code>实例，默认使用<code>org.apache.catalina.core.StandardService</code>.默认情况下 , Tomcat仅指定了Service的名称，值为”Catalina”。</li>
<li>Service 可以内嵌的元素为: Listener，Executor，Connector，Engine <ul>
<li>Listener用于为Service添加生命周期监听器</li>
<li>Executor 用于配置Service共享线程池</li>
<li>Connector用于配置service包含的链接器</li>
<li>Engine用于配置Service中链接器对应的Servlet容器引擎</li>
</ul>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Service</span> <span class="attr">name</span>=<span class="string">"Catalina"</span>&gt;</span></span><br><span class="line">	...</span><br><span class="line"><span class="tag">&lt;/<span class="name">Service</span>&gt;</span></span><br></pre></td></tr></table></figure>





<h4 id="4-1-3-Executor"><a href="#4-1-3-Executor" class="headerlink" title="4.1.3.Executor"></a>4.1.3.Executor</h4><ul>
<li>默认情况下, Service并未添加共享线程池配置。如果我们想<strong>添加一个线程池</strong>，可以在&lt;Service&gt; 添加如下配置</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Executor</span> <span class="attr">name</span>=<span class="string">"tomcatThreadPool"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">namePrefix</span>=<span class="string">"catalina-exec-"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">maxThreads</span>=<span class="string">"1000"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">minSpareThreads</span>=<span class="string">"100"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">maxIdleTime</span>=<span class="string">" 60000"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">maxQueueSize</span>=<span class="string">"Integer.MAX_VALUE"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">prestartminSpareThreads</span>=<span class="string">"false"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">threadPriority</span>=<span class="string">"5"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">className</span>=<span class="string">"org.apache.catalina.core.StandardThreadExecutor"</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th align="center">属性</th>
<th align="center">含义</th>
</tr>
</thead>
<tbody><tr>
<td align="center">name</td>
<td align="center">线程池名称,用于Connector中指定</td>
</tr>
<tr>
<td align="center">namePrefix</td>
<td align="center">所创建的每个线程的名称前缀，一个单独的线程名称为namePrefix+threadNumber</td>
</tr>
<tr>
<td align="center">maxThreads</td>
<td align="center">池中最大线程数</td>
</tr>
<tr>
<td align="center">minSpareThreads</td>
<td align="center">活跃线程数/核心池线程数,这些线程不会被销毁会直存在</td>
</tr>
<tr>
<td align="center">maxIdleTime</td>
<td align="center">线程空闲时间,超过该时间后,空闲线程会被销毁,默认值为6000 ( 1分钟) , 单位毫秒。</td>
</tr>
<tr>
<td align="center">maxQueueSize</td>
<td align="center">在被执行前最大线程排队数目，默认为Int的最大值，也就是广义的无限。除非特殊情况,这个值不需要更改 否则会有请求不会被处理的情况发生</td>
</tr>
<tr>
<td align="center">prestartminSpareThreads</td>
<td align="center">启动线程池时是否启动minSpareThreads部分线程。默认值为false ,即不启动</td>
</tr>
<tr>
<td align="center">threadPriority</td>
<td align="center">线程池中线程优先级,默认值为5 ,值从1到10</td>
</tr>
<tr>
<td align="center">className</td>
<td align="center">线程池实现类,未指定情况下,默认实现类为org.apache.catalina.core.StandardThreadexecutor.如果想使用自定义线程池首先需要实现org.apache.catalina.Executor接口</td>
</tr>
</tbody></table>
<ul>
<li>如果不配置共享线程池，那么catalina各组件在用到线程池时会独立创建</li>
</ul>
<h4 id="4-1-4-Connector"><a href="#4-1-4-Connector" class="headerlink" title="4.1.4 Connector"></a>4.1.4 Connector</h4><ul>
<li>Connector用于创建链接器实例。默认情况下, server.xml配置了两个链接器, 一个支持Http协议，一个支持AJP协议。因此大多数情况下,我们并不需要新增链接器配置,只是根据需要对已有链接器进行优化。</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Connector</span> <span class="attr">port</span>=<span class="string">"8080"</span> <span class="attr">protocol</span>=<span class="string">"HTTP/1.1"</span> <span class="attr">connectionTimeout</span>=<span class="string">"20000"</span> <span class="attr">redirectPort</span>=<span class="string">"8443"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">Connector</span> <span class="attr">port</span>=<span class="string">"8009"</span> <span class="attr">protocol</span>=<span class="string">"AJP/1.3"</span> <span class="attr">redirectPort</span>=<span class="string">"8443"</span> <span class="attr">executor</span>=<span class="string">"tomcatThreadPool"</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>属性说明:</p>
<ul>
<li>port: 端口号, Connector用于创建服务端Socket并进行监听，以等待客户端请求链接。 如果该属性设置为0 , Tomcat将会随机选择一个可用的端口号给当前Connector使用</li>
<li>connectionTimeout: connector 接收链接后的等待超时时间，单位为毫秒。-1 表示不超时。</li>
<li>redirectPort: 当前connector不支持ssl请求，接收到了一个请求，并且也符合security-constraint约束，需要ssl传输，Catalina自动将请求重定向到指定的端口</li>
<li>executor :指定共享线程池的名称，也可以通过maxThreads，minSpareThreads 等属性配置内部线程池。</li>
<li>URIEncoding :用于指定编码URI的字符编码， Tomcat8.x版本默认的编码为UTF-8</li>
<li>protocol :当前Connector支持的访问协议。默认为HTTP/1.1，并采用自动切换机制选择一个基于JAVA NIO的链接器或者基于本地APR的链接器(根据本地是否含有Tomcat的本地库判定)。</li>
</ul>
</li>
<li><p>如果不希望采用上述自动切换的机制，而是明确指定协议 ，可以使用以下值</p>
<ul>
<li>Http协议</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">org.apache.coyote.http11.Http11NioProtocol   非阻塞式Java NIO链接器</span><br><span class="line">org.apache.coyote.http1l.Http11Nio2Protocol  非阻塞式JAVA NIO2链掖器</span><br><span class="line">org.apache.coyote.httpll.Http11AprProtocol 	 APR链接器</span><br></pre></td></tr></table></figure>

<ul>
<li>AJP协议</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">org.apache.coyote.ajp.AjpNioProtocol   	非阻塞式Java NIO链按器</span><br><span class="line">org.apeche.coyote.ajp.AjpNio2Protocol 	非阻塞式JAVA NI02链接器</span><br><span class="line">org.apache.coyote.ajp.AjpAprprotocol	APR链接器</span><br></pre></td></tr></table></figure>
</li>
<li><p>完整配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Connector</span> <span class="attr">port</span>=<span class="string">"8080"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">protocol</span>=<span class="string">"HTTP/1.1"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">executor</span>=<span class="string">"tomcatThreadPool"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">maxThreads</span>=<span class="string">"1000"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">minSpareThreads</span>=<span class="string">"100"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">acceptCount</span>=<span class="string">"1000"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">maxConnections</span>=<span class="string">"1000”</span></span></span><br><span class="line"><span class="tag"><span class="string">    connectionTimeout="</span><span class="attr">20000</span>"</span></span><br><span class="line"><span class="tag">    <span class="attr">compression</span>=<span class="string">"on"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">compreae1onM1n512e</span>=<span class="string">"2048"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">disableUplondT</span> <span class="attr">imeout</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">redirectPort</span>=<span class="string">"8443"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">URIEncoding</span>=<span class="string">"UTF-8"</span>/&gt;</span></span><br></pre></td></tr></table></figure>



</li>
</ul>
<h4 id="4-1-5-Engine"><a href="#4-1-5-Engine" class="headerlink" title="4.1.5 Engine"></a>4.1.5 Engine</h4><ul>
<li>Engine作为Servlet引擎的顶级元素,内部可以嵌入: Cluster，Listener，Realm, Valve和Host</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;Engine name&#x3D;&quot;Catalina&quot; defaultHost&#x3D;&quot;localhost&quot;&gt;</span><br><span class="line">	...</span><br><span class="line">&lt;&#x2F;Engine&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>属性说明:<ul>
<li>name: 用于指定Engine的名称，默认为catalina 。该名称会影响一部分Tomcat的存储路径 (如临时文件)</li>
<li>defaultHost :默认使用的虚拟主机名称，当客户端请求指向的主机无效时，将交由默认的虚拟主机处理， 默认为loalhost。</li>
</ul>
</li>
</ul>
<h4 id="4-1-6-Host"><a href="#4-1-6-Host" class="headerlink" title="4.1.6 Host"></a>4.1.6 Host</h4><ul>
<li>Host元素用于配置一个虚拟主机，它支持以下嵌入元素: Alias、Cluster、 Listener、 Valve、 Realm, Context。 </li>
<li>如果在Engine下配置Realm，那么此配置将在当前Engine 下的所有Host中共享。</li>
<li>同样 。如果在Host中配置Realm，则在当前Host 下的所有Context中共享。</li>
<li>Context中的Realm优先級&gt; Host的Realm优先级&gt; Engine中的Realm优先级。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;Host name&#x3D;&quot;localhost&quot;  appBase&#x3D;&quot;webapps&quot; unpackWARs&#x3D;&quot;true&quot; autoDeploy&#x3D;&quot;true&quot;&gt;</span><br><span class="line">	...</span><br><span class="line">&lt;\Host&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>属性说明:</p>
<ul>
<li>name:当前Host通用的网络名称，必须与DNS服务器 上的注册信息一致。Engine中包含的Host必须存在一个名称与Engine的defaultHost设置一致</li>
<li>appBase: 当前Host的应用基础目录，当前Host上部署的web应用均在该目录下(可以是绝对目录,相对路径)。默认为webapps。</li>
<li>unpackWARs: 设置为true，Host在启动时会将appBase目录下war包解压为目录。设置为false, Host将直接从war文件启动。</li>
<li>autoDeploy :控制tomcat是否在运行时定期检测并自动部署新增或变更的web应用。</li>
</ul>
</li>
<li><p>通过给Host添加别名。我们可以实现同-个Host拥有多个网络名称,配置如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;Host name&#x3D;&quot;www.web1.com&quot;  appBase&#x3D;&quot;webapps&quot; unpackWARs&#x3D;&quot;true&quot; autoDeploy&#x3D;&quot;true&quot;&gt;</span><br><span class="line">	&lt;Alias&gt;www.web1.com&lt;&#x2F;Alias&gt;</span><br><span class="line">&lt;\Host&gt;</span><br></pre></td></tr></table></figure>





</li>
</ul>
<h4 id="4-1-7-Context"><a href="#4-1-7-Context" class="headerlink" title="4.1.7 Context"></a>4.1.7 Context</h4><ul>
<li>Context用于配置一个Web应用 。默认的配置如下:</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;Context docBase&#x3D;&quot;myApp&quot; path&#x3D;&quot;&#x2F;myApp&quot;&gt;</span><br><span class="line">	...</span><br><span class="line">&lt;\Context&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>属性描述:<ul>
<li>docBase : web应用目录或者war包的部署路径。可以是绝对路径,也可以是相对于Host appBase的相对路径。</li>
<li>path : web应用的Context路径。如果我们Host名为localhost，则该web应用访问的根路径为 : <a href="http://localhost:8080/myApp" target="_blank" rel="noopener">http://localhost:8080/myApp</a></li>
</ul>
</li>
<li>它支持的内嵌元索为: CookieProcessor, Loader, Manager , Realm, Resources , WatchedResource，JarScanner , VaIve</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;Host name&#x3D;&quot;www.tomcat.com&#39; appBase&#x3D;&quot;webapps&quot; unpackWARs&#x3D;&quot;true&quot; autoDeploy&#x3D;&quot;true&quot;&gt;</span><br><span class="line">	</span><br><span class="line">	&lt;Context docBase&#x3D;&quot;D:\servlet_project03&quot; path&#x3D;&quot;&#x2F;myApp&quot;&gt;&lt;&#x2F;Context&gt;</span><br><span class="line">	</span><br><span class="line">	&lt;Valve className&#x3D;&quot;org.apache.catalina.valves.AccessLogValve&quot; directory&#x3D;&quot;logs&quot; prefix&#x3D;&quot;localhost_access_log&quot; suffix&#x3D;&quot;.txt&quot;</span><br><span class="line">pattern&#x3D;&quot;&amp;h %l %u %t &quot;%r%quot; %s &amp;b&quot; &#x2F;&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;Host&gt;</span><br></pre></td></tr></table></figure>



<h3 id="4-2-tomcat-users-xml"><a href="#4-2-tomcat-users-xml" class="headerlink" title="4.2. tomcat-users.xml"></a>4.2. tomcat-users.xml</h3><ul>
<li>该配置文件中。主要配置的是Tomcat的用户，角色等信息。用来控制Tomcat中manager，host-manager的访问权限。</li>
</ul>
<h2 id="5-Web配置文件"><a href="#5-Web配置文件" class="headerlink" title="5.Web配置文件"></a>5.Web配置文件</h2><ul>
<li><code>web.xml</code>是web应用的描述文件，它支持的元素及属性来自于Servlet规范定义。</li>
<li>在Tomcat中，web应用的描述信息包括<strong>tomcat/conf/web.xml</strong>中默认配置以及Web应用<strong>WEB-INF/web. xml下</strong>的定制配置</li>
</ul>
<h3 id="5-1-ServletContext初始化参数"><a href="#5-1-ServletContext初始化参数" class="headerlink" title="5.1.ServletContext初始化参数"></a>5.1.ServletContext初始化参数</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>project_param_01<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">param-value</span>&gt;</span>itcast<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String value &#x3D; req.getServletContext().getInitParameter(&quot;project_param_01&quot;);</span><br></pre></td></tr></table></figure>



<h3 id="5-2会话配置"><a href="#5-2会话配置" class="headerlink" title="5.2会话配置"></a>5.2会话配置</h3><p><code>&lt;session-config&gt;</code>用于配置web应用会话,包括超时时间，Cookie配置以及会话追踪模式。它将覆盖server.xml和context.xml中的配置。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Session-config</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">session-timeout</span>&gt;</span>30<span class="tag">&lt;/<span class="name">session-timeout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">cookie-config</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>JESSIONID<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">domain</span>&gt;</span>www.itcast.cn<span class="tag">&lt;/<span class="name">domain</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">path</span>&gt;</span>/<span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">comment</span>&gt;</span>Session Cookie<span class="tag">&lt;/ <span class="attr">comment</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">http-only</span>&gt;</span>true<span class="tag">&lt;/<span class="name">http-only</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">secure</span>&gt;</span>false<span class="tag">&lt;/<span class="name">secure</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">max-age</span>&gt;</span>3600<span class="tag">&lt;/<span class="name">max-age</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">cookie-config</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tracking-mode</span>&gt;</span>COOKIE<span class="tag">&lt;/<span class="name">tracking-mode</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">session-config</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">1) session-timeout 				会话超时时间,单位分钟</span><br><span class="line">2) cookie-config				用于配置会话追踪Cookie</span><br><span class="line">3) name 						Cookie的名称</span><br><span class="line">4) domain  						Cookie的域名</span><br><span class="line">5) path  						Cookie的路径</span><br><span class="line">6) comment 					注释</span><br><span class="line">7) http-only  					cookie只能通过HTTP方式进行访问，Js无法读取或修改，此项可以增加网站访问的安全性</span><br><span class="line">8) secure 						此cookie只能通过HTTPs连接传递到服务器,而HTTP连接则不会传递该信息。注意是从浏览器传递到服务器，服务器端的Cookie对象不受此项影响</span><br><span class="line">9) max-age 					以秒为单位表示cookie的生存期，默认为-1表示是会话Cookie ,浏览器关闭时就会消失</span><br><span class="line">10) tracking-mode 				用于配置会话追踪模式，Servlet3.0版本中支持的追踪模式 COOKIE、 URL、 SSL</span><br><span class="line">	1.COOKIE——通过HTTP Cookie 追踪会话是最常用的会话追踪机制，而且servlet规范也要求所有的Servlet规范都需要支持Cookie追踪。</span><br><span class="line">    2.URL——URL重写是最基本的会话追踪机制。当客户端不支持Cookie时，可以采用URI重写的方式。当采用URL追踪模式时,请求路径需要包含会话标识信息，Servlet容器会根据路径中的会话标识设置请求的会话信息。如:</span><br><span class="line">    http:&#x2F;&#x2F;www.myserver.com&#x2F;user&#x2F;index.html;jessionid&#x3D;1234567890</span><br><span class="line">    3.SSL——对于ssL请求，通过ssl会话标识确定请求会话标识</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String session &#x3D; req.getSession().getId()</span><br></pre></td></tr></table></figure>



<h3 id="5-3-Servlet配置"><a href="#5-3-Servlet配置" class="headerlink" title="5.3. Servlet配置"></a>5.3. Servlet配置</h3><ul>
<li>Servlet的配置主要是两部分，servlet 和servlet-mapping</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>myServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">servlet-c1ass</span>&gt;</span>cn.itcast.web.MyServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">init-param</span>&gt;</span>	此处的初始化参数只对本Servlet有效</span><br><span class="line">		<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>fileName<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">param</span> <span class="attr">value</span>&gt;</span>init.conf<span class="tag">&lt;/<span class="name">param</span> <span class="attr">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>myServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">ur1-pattern</span>&gt;</span>*.do<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">ur1-pattern</span>&gt;</span>/myservet/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1) servlet-name  	指定servlet的名称 该属性在web.xml中唯一</span><br><span class="line">2) servlet-class	用于指定servlet类名</span><br><span class="line">3) init-param		用于指定servlet的初始化参数，在应用中可以通过HttpServlet.getInitParameter获取</span><br><span class="line">4) load-on-startup  用于控制在Web应用启动时，Servlet的加载顺序 值小于0第一次访问时加载</span><br><span class="line">5) enabled:true&#x2F;false 若为false 表示servlet不处理任何请求</span><br></pre></td></tr></table></figure>



<h3 id="5-4-Listener配置"><a href="#5-4-Listener配置" class="headerlink" title="5.4 Listener配置"></a>5.4 Listener配置</h3><ul>
<li><p>Listener用于监听servlet中的事件，例如context，request，session对象的创建、修改、删除，并触发响应事件。</p>
</li>
<li><p>Listener是<strong>观察者模式</strong>的实现，在Servlet中主要用于对context、request、 session对象的生命周期进行监控。在servlet2.5规范中共定义了8种Listener。</p>
</li>
<li><p>在启动时, servletContextListener的执行顺序与web.xml中的配置顺序一致，停止时执行顺序相反</p>
</li>
</ul>
<h3 id="5-5-Filter配置"><a href="#5-5-Filter配置" class="headerlink" title="5.5 Filter配置"></a>5.5 Filter配置</h3><ul>
<li>Filter用于配置web应用过滤器，用来过滤资源请求及响应。经常用于认证、日志、加密、数据转换等操作，配置如下:</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>myFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>cn.itcast.web.MyFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">async-supported</span>&gt;</span>true<span class="tag">&lt;/<span class="name">async-supported</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>language<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">param-value</span>&gt;</span>CN<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>myFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1) filter-name 		用于指定过滤器名称 在web.xml中，过滤器名称必须唯一</span><br><span class="line">2) filter-class 	过滤器的全限定类名，该类必须实现Filter接口</span><br><span class="line">3) async-supported	该过滤器是否支持异步</span><br><span class="line">4) init-param 		用于配置Filter的初始化参数 可以配置多个 可以通过Fi lterConfig.getInitParameter获取</span><br><span class="line">5) ur1-pattern		指定该过滤器需要拦截的URL</span><br></pre></td></tr></table></figure>



<h3 id="5-6欢迎页面配置"><a href="#5-6欢迎页面配置" class="headerlink" title="5.6欢迎页面配置"></a>5.6欢迎页面配置</h3><ul>
<li><p>welcome- file-list用于指定web应用的欢迎文件列表</p>
<ul>
<li>尝试请求的顺序,从上到下</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.html<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.htm<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.jsp<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">welcome-file-list</span>&gt;</span></span><br></pre></td></tr></table></figure>



</li>
</ul>
<h3 id="5-7错误页面配置"><a href="#5-7错误页面配置" class="headerlink" title="5.7错误页面配置"></a>5.7错误页面配置</h3><ul>
<li>error-page用于配置web应用访问异常时定向到的页面,支持HTTP响应码和异常类两种形式。</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">error-page</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">error-code</span>&gt;</span>404<span class="tag">&lt;<span class="name">error-code</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">location</span>&gt;</span>/404.html<span class="tag">&lt;/<span class="name">location</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">error-page</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">error-page</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">error-code</span>&gt;</span>500<span class="tag">&lt;/<span class="name">error-code</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">location</span>&gt;</span>/500.html<span class="tag">&lt;/<span class="name">location</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">error-page</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">error-page</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">exception-type</span>&gt;</span>java.lang.Exception<span class="tag">&lt;/<span class="name">exception-type</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">location</span>&gt;</span>/error.jsp<span class="tag">&lt;/<span class="name">location</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">error-page</span>&gt;</span></span><br></pre></td></tr></table></figure>





<h2 id="6-Tomcat-管理配置"><a href="#6-Tomcat-管理配置" class="headerlink" title="6.Tomcat 管理配置"></a>6.Tomcat 管理配置</h2><ul>
<li><p>从早期的Tomcat版本开始,就提供了web版的管理控制台,他们是两个独立的web应用,位于webapps目录下</p>
</li>
<li><p>Tomcat 提供的管理应用有用于<strong>管理Host的host-manager</strong>和用于<strong>管理web应用的manager</strong></p>
<p><img src="1576044964425.png" alt="1576044964425"></p>
</li>
</ul>
<h3 id="6-1-host-manager"><a href="#6-1-host-manager" class="headerlink" title="6.1 host-manager"></a>6.1 host-manager</h3><ul>
<li>Tomcat启动之后,可以通过<a href="http://localhost:8080/host-manager/html访问该Web应用。" target="_blank" rel="noopener">http://localhost:8080/host-manager/html访问该Web应用。</a></li>
</ul>
<p><img src="1576045815612.png" alt="1576045815612"></p>
<ul>
<li>host-manager 默认添加了访问权限控制，当打开网址时,需要输入用户名和密码( conf/tomcat-users.xml中配置)。所以要想访问该页面,需要在conf/tomcat-users.xml中配置,并分配对应的角色:<ul>
<li>admin-gui :用于控制页面访问权限</li>
<li>admin-script :用于控制以简单文本的形式进行访问</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># conf&#x2F;tomcat-users.xml</span><br><span class="line"></span><br><span class="line">&lt;role rolename&#x3D;&quot;admin-gui&quot;&#x2F;&gt;</span><br><span class="line">&lt;role rolename&#x3D;&quot;admin-script&quot;&#x2F;&gt;</span><br><span class="line">&lt;user username&#x3D;&quot;yyx&quot; passwd&#x3D;&quot;123456&quot; role&#x3D;&quot;admin-script,admin-gui&quot;&#x2F;&gt;</span><br></pre></td></tr></table></figure>

<p><img src="1576047327639.png" alt="1576047327639"></p>
<p><img src="1576046944691.png" alt="1576046944691"></p>
<h3 id="6-2-manager"><a href="#6-2-manager" class="headerlink" title="6.2. manager"></a>6.2. manager</h3><ul>
<li>manager的访问地址为<a href="http://localhost:8080/manager，同样，manager也添加了" target="_blank" rel="noopener">http://localhost:8080/manager，同样，manager也添加了</a> 页面访问控制,因此我们需要为登录用户分配角色</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># conf&#x2F;tomcat-users.xml</span><br><span class="line"></span><br><span class="line">&lt;role rolename&#x3D;&quot;manager-gui&quot;&#x2F;&gt;</span><br><span class="line">&lt;role rolename&#x3D;&quot;manager-script&quot;&#x2F;&gt;</span><br><span class="line">&lt;user username&#x3D;&quot;yyx&quot; password&#x3D;&quot;123456&quot; roles&#x3D;&quot;admin-script,admin-gui,manager-gui,manager-script&quot;&#x2F;&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>登录查看web应用</li>
</ul>
<p><img src="1576047290767.png" alt="1576047290767"></p>
<p><img src="1576047723908.png" alt="1576047723908"></p>
<ul>
<li>查看Server状态</li>
</ul>
<p><img src="1576048474484.png" alt="1576048474484"></p>
<p><img src="1576048503640.png" alt="1576048503640"></p>
<h2 id="7-JVM配置"><a href="#7-JVM配置" class="headerlink" title="7.JVM配置"></a>7.JVM配置</h2><ul>
<li>最常见的JVM配置当属内存分配,因为在绝大多数情况下, JVM默认分配的内存可能不能够满足我们的需求,特别是在生产环境,此时需要手动修改Tomcat启动时的内存参数分配</li>
</ul>
<h3 id="7-1-JVM内存模型图"><a href="#7-1-JVM内存模型图" class="headerlink" title="7.1. JVM内存模型图"></a>7.1. JVM内存模型图</h3><p><img src="1576048846734.png" alt="1576048846734"></p>
<h3 id="7-2-JVM配置选项"><a href="#7-2-JVM配置选项" class="headerlink" title="7.2. JVM配置选项"></a>7.2. JVM配置选项</h3><ul>
<li>Windows平台（catalina.bat）</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set JAVA_OPTS&#x3D;-server -Xms2048m -Xmx2048m -XX:MetaspaceSize&#x3D;256m -XX:MaxMetaspaceSize&#x3D;256m -XX:SurvivorRatio&#x3D;8</span><br></pre></td></tr></table></figure>

<ul>
<li>linux平台（catalina.sh）</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">JAVA_OPTS&#x3D;&quot;-server -Xms1024m -Xmx2048m -XX:MetaspaceSize&#x3D;256m -XX:MaxMetaspaceSize&#x3D;512m  -XX:SurvivorRatio&#x3D;8&quot;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th align="center">序号</th>
<th align="center">参数</th>
<th align="center">含义</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1</td>
<td align="center">-Xms</td>
<td align="center">堆内存的初始大小</td>
</tr>
<tr>
<td align="center">2</td>
<td align="center">-Xmx</td>
<td align="center">堆内存的最大大小</td>
</tr>
<tr>
<td align="center">3</td>
<td align="center">-Xmn</td>
<td align="center">新生代的内存大小，官方建议是整个堆得3/8。</td>
</tr>
<tr>
<td align="center">4</td>
<td align="center">-XX:MetaspaceSize</td>
<td align="center">元空间内存初始大小，在JDK1. 8版本之前配置为-xx:Permsize (永久代)</td>
</tr>
<tr>
<td align="center">5</td>
<td align="center">-XX:MaxMetaspaceSize</td>
<td align="center">元空间内存最大大小，在JDK1 .8版本之前配置为-Xx:MaxPermsize (永久代}</td>
</tr>
<tr>
<td align="center">6</td>
<td align="center">-XX:NewRatio</td>
<td align="center">设置新生代和老年代的相对大小比例。这种方式的优点是新生代大小会随着整个堆大小动态扩展。如-XX:NewRatio=3 指定老年代/新生代为3/1。老年代占堆大小的3/4.新生代占1/4。</td>
</tr>
<tr>
<td align="center">7</td>
<td align="center">-XX:SurvivoRatio</td>
<td align="center">指定伊甸园区(Eden) 与幸存区大小比例。如-XX:survivorRatio=10 表示伊甸园区(Eden) 是幸存区To大小的10 倍(也是幸存区From 的10倍)。所以，伊甸园区(Eden) 占新生代大小的10/12， 幸存区From和幸存区To每个占新生代的1/12。注意， 两个幸存区永远是一样大的。</td>
</tr>
</tbody></table>
<p><img src="1576051053125.png" alt="1576051053125"></p>
<h2 id="8-Tomcat集群"><a href="#8-Tomcat集群" class="headerlink" title="8.Tomcat集群"></a>8.Tomcat集群</h2><h3 id="8-1-介绍"><a href="#8-1-介绍" class="headerlink" title="8.1. 介绍"></a>8.1. 介绍</h3><ul>
<li>由于单台Tomcat的承载能力是有限的，当我们的业务系统用户量比较大，请求压力比较大时，单台Tomcat是扛不住的,这个时候,就需要搭建Tomcat的集群,而目前比较流程的做法就是通过Nginx来实现tomcat集群的负载均衡。</li>
</ul>
<p><img src="1576052233452.png" alt="1576052233452"></p>
<h3 id="8-2-环境准备"><a href="#8-2-环境准备" class="headerlink" title="8.2.环境准备"></a>8.2.环境准备</h3><h4 id="8-2-1-准备多台Tomcat"><a href="#8-2-1-准备多台Tomcat" class="headerlink" title="8.2.1. 准备多台Tomcat"></a>8.2.1. 准备多台Tomcat</h4><ul>
<li><p>在服务器上，安装两台tomcat【复制两个Tomcat目录】，然后分别改Tomcat服务器的端口号</p>
<p><img src="1576054953362.png" alt="1576054953362"></p>
<ul>
<li>关闭命令监听端口</li>
</ul>
<p><img src="1576054717113.png" alt="1576054717113"></p>
<ul>
<li><p>HTTP监听端口</p>
<p><img src="1576054744011.png" alt="1576054744011"></p>
</li>
<li><p>AJP监听端口</p>
<p><img src="1576054764258.png" alt="1576054764258"></p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">原配置         Tomcat1	      Tomcat2</span><br><span class="line">8005 ---------&gt; 8015 ---------&gt; 8025</span><br><span class="line">8080 ---------&gt; 8888 ---------&gt; 9999</span><br><span class="line">8009 ---------&gt; 8019 ---------&gt; 8029</span><br></pre></td></tr></table></figure>

<p><img src="1576055872117.png" alt="1576055872117"></p>
<p><img src="1576055904020.png" alt="1576055904020"></p>
</li>
</ul>
<h4 id="8-2-2-准备Nginx"><a href="#8-2-2-准备Nginx" class="headerlink" title="8.2.2. 准备Nginx"></a>8.2.2. 准备Nginx</h4><ul>
<li><p>在当前服务器上，安装Nginx，然后再配置Nginx,配置nginx.conf</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">upstream serverpool&#123;</span><br><span class="line">	server localhost:8888;</span><br><span class="line">	server localhost:9999;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">	listen 99;</span><br><span class="line">	server_name localhost;</span><br><span class="line">	location &#x2F; &#123;</span><br><span class="line">		proxy_pass http:&#x2F;&#x2F;serverpool&#x2F;;		# 反向代理</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<p><img src="1576056073323.png" alt="1576056073323"></p>
</li>
</ul>
<h3 id="8-3-负载均衡策略"><a href="#8-3-负载均衡策略" class="headerlink" title="8.3. 负载均衡策略"></a>8.3. 负载均衡策略</h3><ul>
<li><p>轮询</p>
<ul>
<li>最基本的配置方法,它是upstream模块默认的负载均衡默认策略。每个请求会按时间顺序逐一分配到不同的后端服务器。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">upstream serverpool&#123;</span><br><span class="line">	server localhost:8888;</span><br><span class="line">	server localhost:9999;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th align="center"></th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">fail_timeout</td>
<td align="center">与max_fails结合使用</td>
</tr>
<tr>
<td align="center">max_fails</td>
<td align="center">设置在fail_timeout参数设置的时间内最大失败次数,如果在这个时间内,所有针对该服务器的请求都失败了,那么认为该服务器会被认为是停机了</td>
</tr>
<tr>
<td align="center">fail_time</td>
<td align="center">服务器会被认为停机的时间长度,默认为10s</td>
</tr>
<tr>
<td align="center">backup</td>
<td align="center">标记该服务器为备用服务器。当主服务器停止时，请求会被发送到它这里</td>
</tr>
<tr>
<td align="center">down</td>
<td align="center"></td>
</tr>
</tbody></table>
</li>
<li><p>weight权重</p>
<ul>
<li>权重方式,在轮询策略的基础上指定轮询的几率</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">upstream serverpool&#123;</span><br><span class="line">	server localhost:8888 weight&#x3D;3;</span><br><span class="line">	server localhost:9999 weight&#x3D;2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>weight参数用于指定轮训几率, weight的默认值为1 ;</li>
<li>weight的数值与访问比率成正比</li>
<li>此策略比较适合服务器的硬件配置差别比较大的情况</li>
</ul>
</li>
<li><p>ip_hash</p>
<ul>
<li>指定负载均衡器按照基于客户端IP的分配方式</li>
<li>这个方法确保了相同的客户端的请求一直发送到相同的服务器,以保证session会话。</li>
<li>这样每个访客都固定访问一个后端服务器,可以解决session不能跨服务器的问题。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">upstream serverpool&#123;</span><br><span class="line">	ip_hash;</span><br><span class="line">	server 192.168.192.133:8080	weight&#x3D;3;</span><br><span class="line">	server 192.168.192.137:8080 weight&#x3D;2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>




</li>
</ul>
<h3 id="8-4-Session共享方案"><a href="#8-4-Session共享方案" class="headerlink" title="8.4.Session共享方案"></a>8.4.Session共享方案</h3><ul>
<li>在Tomcat集群中,如果应用需要用户进行登录,那么这个时候,用于tomcat做了负载均衡,则用户登录并访问应用系统时,就会出现问题</li>
</ul>
<p><img src="1576135360218.png" alt="1576135360218"></p>
<h4 id="8-4-1-ip-hash-策略"><a href="#8-4-1-ip-hash-策略" class="headerlink" title="8.4.1 ip_hash 策略"></a>8.4.1 ip_hash 策略</h4><ul>
<li>一个用户发起的请求,只会请求到tomcatA上进行操作，另一个用户发起的请求只在tomcatB上进行操作。那么这个时候,同一个用户发起的请求。都会通过nginx的ip_ hash策略,将请求转发到其中的一台Tomcat上。</li>
</ul>
<h4 id="8-4-2-Session复制"><a href="#8-4-2-Session复制" class="headerlink" title="8.4.2. Session复制"></a>8.4.2. Session复制</h4><ul>
<li>在sexvlet_demo01工程中，制作seession.jsp页面。分别将工程存放在两台tomcat的webapps/目录下</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language&#x3D;&quot;java&quot; contentType&#x3D;&quot;text&#x2F;html; charset&#x3D;UTF-8&quot;</span><br><span class="line">         pageEncoding&#x3D;&quot;UTF-8&quot;%&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;login&lt;&#x2F;title&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">TOMCAT---A&#x2F;B</span><br><span class="line">sessionID: &lt;%&#x3D; session.getId() %&gt;</span><br><span class="line"></span><br><span class="line">&lt;%</span><br><span class="line">    Object loginUser &#x3D; session.getAttribute(&quot;loginUser&quot;);</span><br><span class="line">    if(loginUser !&#x3D; null &amp;&amp; loginUser.toString().length()&gt;0) &#123;</span><br><span class="line">        out.println(&quot;session有值，loginUser &#x3D;&quot; + loginUser);&#125;</span><br><span class="line">    else&#123;</span><br><span class="line">        session.setAttribute(&quot;loginUser&quot;,&quot;ITCAST&quot;);</span><br><span class="line">        out.println(&quot;session没有值&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">%&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>配置小规模Session复制负载均衡</p>
<ul>
<li><p>配置前</p>
<ul>
<li>第一次访问8888Tomcat</li>
</ul>
<p><img src="1576137216858.png" alt="1576137216858"></p>
<ul>
<li>第一次访问9999Tomcat——之前访问8888记录未同步——session无值</li>
</ul>
<p><img src="1576137248739.png" alt="1576137248739"></p>
</li>
<li><p>配置</p>
<ul>
<li>在conf/server.xml文件中</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Cluster className&#x3D;&quot;org.apache.catalina.ha.top.SimpleTopCluster&quot;&#x2F;&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>在工程web.xml中，增加一行</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;distributable&#x2F;&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置后</p>
<ul>
<li>第一次访问8888Tomcat</li>
</ul>
<p><img src="1576137111345.png" alt="1576137111345"></p>
<ul>
<li>第一次访问9999Tomcat——之前访问8888记录同步——session有值</li>
</ul>
<p><img src="1576137138658.png" alt="1576137138658"></p>
</li>
</ul>
</li>
<li><p>Session复制实现Session共享弊端</p>
<ul>
<li>适用于较小的集群环境(节点数不超过4个) </li>
<li>如果集群的节点数比较多的话,通过<strong>这种广播的形式</strong>来完成session的复制，会消耗大量的网络带宽,影响服务的性能</li>
</ul>
</li>
</ul>
<h4 id="8-4-3-SSO-单点登录【重点】"><a href="#8-4-3-SSO-单点登录【重点】" class="headerlink" title="8.4.3.SSO-单点登录【重点】"></a>8.4.3.SSO-单点登录【重点】</h4><ul>
<li>单点登录(Single Sign On) , 简称为SSO，是目前比较流行的企业业务整合的解决方案之一。</li>
<li>SSO的定义是在多个应用系统中,用户只需要登录一次就可以访问所有相互信任的应用系统,也是用来解决集群环境session共享的方案之一</li>
</ul>
<p><img src="1576137868773.png" alt="1576137868773"></p>
</div><div class="post-copyright"><blockquote><p>原文作者: 掘金木匠</p><p>原文链接: <a href="http://goldcarpenter.github.io/2020/01/20/Tomcat_Part2/">http://goldcarpenter.github.io/2020/01/20/Tomcat_Part2/</a></p><p>版权声明: 转载请注明出处(必须保留作者署名及链接)</p></blockquote></div><div class="tags"><a href="/tags/Tomcat/">Tomcat</a></div><div class="post-share"><div class="social-share"><span>分享到:</span></div></div><div class="post-nav"><a href="/2020/02/02/javaIO/" class="pre">JavaIO</a><a href="/2020/01/11/Tomcat_Part1/" class="next">Tomcat</a></div><div id="comments"><div id="SOHUCS" sid="2020/01/20/Tomcat_Part2/"></div></div></div></div></div><div class="layout-r"><div id="sidebar"><div class="search-pla"></div><div id="toc" class="widget"><div class="widget-title"><i class="fa fa-fei">文章目录</i></div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Tomcat"><span class="toc-text">Tomcat</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-Tomcat服务器配置"><span class="toc-text">4. Tomcat服务器配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-server-xml"><span class="toc-text">4.1.server.xml</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-1-Server"><span class="toc-text">4.1.1.Server</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-2-Service"><span class="toc-text">4.1.2.Service</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-3-Executor"><span class="toc-text">4.1.3.Executor</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-4-Connector"><span class="toc-text">4.1.4 Connector</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-5-Engine"><span class="toc-text">4.1.5 Engine</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-6-Host"><span class="toc-text">4.1.6 Host</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-7-Context"><span class="toc-text">4.1.7 Context</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-tomcat-users-xml"><span class="toc-text">4.2. tomcat-users.xml</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-Web配置文件"><span class="toc-text">5.Web配置文件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-ServletContext初始化参数"><span class="toc-text">5.1.ServletContext初始化参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2会话配置"><span class="toc-text">5.2会话配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-Servlet配置"><span class="toc-text">5.3. Servlet配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-4-Listener配置"><span class="toc-text">5.4 Listener配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-5-Filter配置"><span class="toc-text">5.5 Filter配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-6欢迎页面配置"><span class="toc-text">5.6欢迎页面配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-7错误页面配置"><span class="toc-text">5.7错误页面配置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-Tomcat-管理配置"><span class="toc-text">6.Tomcat 管理配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-host-manager"><span class="toc-text">6.1 host-manager</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-manager"><span class="toc-text">6.2. manager</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-JVM配置"><span class="toc-text">7.JVM配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-JVM内存模型图"><span class="toc-text">7.1. JVM内存模型图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-JVM配置选项"><span class="toc-text">7.2. JVM配置选项</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-Tomcat集群"><span class="toc-text">8.Tomcat集群</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8-1-介绍"><span class="toc-text">8.1. 介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2-环境准备"><span class="toc-text">8.2.环境准备</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#8-2-1-准备多台Tomcat"><span class="toc-text">8.2.1. 准备多台Tomcat</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-2-2-准备Nginx"><span class="toc-text">8.2.2. 准备Nginx</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-3-负载均衡策略"><span class="toc-text">8.3. 负载均衡策略</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-4-Session共享方案"><span class="toc-text">8.4.Session共享方案</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#8-4-1-ip-hash-策略"><span class="toc-text">8.4.1 ip_hash 策略</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-4-2-Session复制"><span class="toc-text">8.4.2. Session复制</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-4-3-SSO-单点登录【重点】"><span class="toc-text">8.4.3.SSO-单点登录【重点】</span></a></li></ol></li></ol></li></ol></li></ol></div><div class="widget"><div class="widget-title"><i class="fa fa-xie"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2020/04/17/Redis_Part3/">Redis</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/04/04/Redis_Part2/">Redis</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/29/Nginx%E5%9F%BA%E7%A1%80/">Nginx</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/26/Redis_Part1/">Redis</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/10/jdk8%E6%96%B0%E7%89%B9%E6%80%A7_Part3/">JDK8新特性</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/02/29/jdk8%E6%96%B0%E7%89%B9%E6%80%A7_Part2/">JDK8新特性</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/02/25/jdk8%E6%96%B0%E7%89%B9%E6%80%A7_Part1/">JDK8新特性</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/02/14/Tomcat_Part4/">Tomcat</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/02/07/Tomcat_Part3/">Tomcat</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/02/02/javaIO/">JavaIO</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-gui"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Debug%E8%AE%B0%E5%BD%95/">Debug记录</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java%E5%9F%BA%E7%A1%80/">Java基础</a><span class="category-list-count">18</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java%E9%AB%98%E7%BA%A7/">Java高级</a><span class="category-list-count">13</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/MySQL%E5%9F%BA%E7%A1%80/">MySQL基础</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Web%E5%BC%80%E5%8F%91/">Web开发</a><span class="category-list-count">17</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/">博客搭建</a><span class="category-list-count">2</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-biao"> 标签</i></div><div class="tagcloud"><a href="/tags/hexo/" style="font-size: 15px;">hexo</a> <a href="/tags/github/" style="font-size: 15px;">github</a> <a href="/tags/Java%E9%9B%86%E5%90%88%E7%B1%BB/" style="font-size: 15px;">Java集合类</a> <a href="/tags/IEDA/" style="font-size: 15px;">IEDA</a> <a href="/tags/JVM/" style="font-size: 15px;">JVM</a> <a href="/tags/Java/" style="font-size: 15px;">Java</a> <a href="/tags/JSON/" style="font-size: 15px;">JSON</a> <a href="/tags/MyBatis/" style="font-size: 15px;">MyBatis</a> <a href="/tags/MySQL/" style="font-size: 15px;">MySQL</a> <a href="/tags/Nginx/" style="font-size: 15px;">Nginx</a> <a href="/tags/Redis/" style="font-size: 15px;">Redis</a> <a href="/tags/SpringMVC/" style="font-size: 15px;">SpringMVC</a> <a href="/tags/Spring/" style="font-size: 15px;">Spring</a> <a href="/tags/String/" style="font-size: 15px;">String</a> <a href="/tags/Tomcat/" style="font-size: 15px;">Tomcat</a> <a href="/tags/ThreadLocal/" style="font-size: 15px;">ThreadLocal</a> <a href="/tags/IO/" style="font-size: 15px;">IO</a> <a href="/tags/%E5%86%85%E9%83%A8%E7%B1%BB/" style="font-size: 15px;">内部类</a> <a href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" style="font-size: 15px;">多线程</a> <a href="/tags/%E6%B3%A8%E8%A7%A3/" style="font-size: 15px;">注解</a> <a href="/tags/%E6%B3%9B%E5%9E%8B/" style="font-size: 15px;">泛型</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-archive"> 归档</i></div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/">2020</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/">2019</a><span class="archive-list-count">39</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/">2018</a><span class="archive-list-count">3</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-you"> 友情链接</i></div><ul></ul><a href="http://www.scu.edu.cn/" title="四川大学首页" target="_blank">四川大学首页</a><ul></ul><a href="http://www.scu.edu.cn/" title="风雨云知道——待部署" target="_blank">风雨云知道——待部署</a><ul></ul><a href="http://www.scu.edu.cn/" title="在线聊天室——待部署" target="_blank">在线聊天室——待部署</a></div></div></div></div><a id="totop" href="#top"></a><div id="footer"><div class="footer-info"><p><a href="/baidusitemap.xml">网站地图</a> |  <a href="/atom.xml">订阅本站</a> |  <a href="/about/">联系博主</a></p><p>本站总访问量：<i id="busuanzi_container_site_pv"><i id="busuanzi_value_site_pv"></i></i>次，本站总访客数:<i id="busuanzi_container_site_uv"><i id="busuanzi_value_site_uv"></i></i>人</p><p><span> Copyright &copy;<a href="/." rel="nofollow">掘金木匠.</a></span><span> Theme by<a rel="nofollow" target="_blank" href="https://github.com/chaooo/hexo-theme-BlueLake"> BlueLake.</a></span><span> Count by<a href="http://busuanzi.ibruce.info/" target="_blank" rel="noopener"> busuanzi.</a></span><span> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></span></p></div></div></div><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><script type="text/javascript" src="/js/search.json.js?v=2.0.4"></script><script type="text/javascript" src="/js/toctotop.js?v=2.0.4" async></script><link rel="stylesheet" type="text/css" href="/share/css/share.css"><script type="text/javascript" src="/share/js/social-share.js" charset="utf-8"></script><script type="text/javascript" src="/share/js/qrcode.js" charset="utf-8"></script><script>window._config = { showScore: true };
(function(){ 
  var appid = 'cyuBR2wWE'; 
  var conf = 'cbd82aee65d05c481319a299102b4811'; 
  var width = window.innerWidth || document.documentElement.clientWidth; 
  var nodes =document.getElementsByTagName("head")[0]||document.head||document.documentElement;
  if (/(Android|iPhone|iPad|iPod|iOS)/i.test(navigator.userAgent) && width < 750) {  
      window.document.write('<script id="changyan_mobile_js" charset="utf-8" type="text/javascript" src="https://changyan.sohu.com/upload/mobile/wap-js/changyan_mobile.js?client_id=' + appid + '&conf=' + conf + '"><\/script>');
  }
  else { 
    var loadJs=function(d,a){
      var b=document.createElement("script");b.setAttribute("type","text/javascript");
      b.setAttribute("charset","UTF-8");
      b.setAttribute("src",d);
      if(typeof a==="function"){if(window.attachEvent){b.onreadystatechange=function(){var e=b.readyState;if(e==="loaded"||e==="complete"){b.onreadystatechange=null;a()}}}else{b.onload=a}}
      nodes.appendChild(b)
    };
    loadJs("https://changyan.sohu.com/upload/changyan.js",function(){window.changyan.api.config({appid:appid,conf:conf})}); 
  } 
  var loadCss = function(cssString){  
    var style=document.createElement("style");  
    style.setAttribute("type", "text/css");  
    if(style.styleSheet){// IE  
        style.styleSheet.cssText = cssString;  
    } else {// w3c  
        var cssText = document.createTextNode(cssString);  
        style.appendChild(cssText);  
    }
    nodes.appendChild(style);
  }
  //- window.onload=function(){
  //-   if(window.outerWidth<=775){
  //-     loadCss('.module-hot-topic,.module-cmt-float-bar{display:none!important}#SOHUCS #SOHU_MAIN .module-cmt-box .post-wrap-w .wrap-action-w .cbox-prompt-w span.prompt-empty-w,#SOHUCS #SOHU_MAIN .module-cmt-float-bar .wrap-cont-w .cont-form-w .form-text-w span.text-null,#SOHUCS #SOHU_MAIN .module-cmt-float-bar .wrap-cont-w .cont-minwidth-w div.cont-comment-w a.comment-link-w,#SOHUCS #SOHU_MAIN .module-cmt-float-bar .wrap-cont-w .cont-minwidth-w div.cont-comment-w span.comment-text-w,#SOHUCS #SOHU_MAIN .module-cmt-footer .section-service-w div.service-wrap-w a:hover,#SOHUCS #SOHU_MAIN .module-cmt-header .section-cbox-w .block-head-w div.header-login,#SOHUCS #SOHU_MAIN .module-cmt-header .section-title-w .title-user-w .user-wrap-w span.wrap-name-w,#SOHUCS #SOHU_MAIN .module-cmt-list .action-click-gw span.click-disable-eg a em.icon-name-bg,#SOHUCS #SOHU_MAIN .module-cmt-list .block-title-gw ul li div.title-name-gw,#SOHUCS #SOHU_MAIN .module-cmt-list .cmt-list-type .cmt-list-number .comment-number span.cy-number,#SOHUCS #SOHU_MAIN .module-cmt-list .cmt-list-type .cmt-list-number span.comment-number,#SOHUCS #SOHU_MAIN .module-cmt-list .cmt-list-type .type-lists li.active,#SOHUCS #SOHU_MAIN .module-cmt-list .msg-wrap-gw .wrap-action-gw .action-click-gw span a:hover,#SOHUCS #SOHU_MAIN .module-cmt-list .picture-box-gw div.box-action-gw a:hover,#SOHUCS #SOHU_MAIN .module-cmt-list .wrap-action-gw .action-click-gw span a:hover em.icon-name-bg,#SOHUCS #SOHU_MAIN .module-cmt-list .wrap-user-gw span.user-name-gw a{color:#40759b!important}#SOHUCS #SOHU_MAIN .module-cmt-box .post-wrap-w .post-wrap-border-t div.post-wrap-border-t-r,#SOHUCS #SOHU_MAIN .module-cmt-box .post-wrap-w div.post-wrap-border-l,#SOHUCS #SOHU_MAIN .module-cmt-box .post-wrap-w div.post-wrap-border-r{display:none!important}#SOHUCS #SOHU_MAIN .module-cmt-box .post-wrap-w .post-wrap-border-t div.post-wrap-border-t-l{background:#FFF!important;top:-2px!important}#SOHUCS #SOHU_MAIN .module-cmt-box .post-wrap-w .wrap-action-w .action-function-w .uploading-wrapper-dw div.wrapper-image-dw,#SOHUCS #SOHU_MAIN .module-cmt-box .post-wrap-w div.post-wrap-main,#SOHUCS #SOHU_MAIN .module-cmt-float-bar .wrap-cont-w .cont-form-w div.form-text-w,#SOHUCS #SOHU_MAIN .module-cmt-header .section-cbox-w .block-head-w div.header-login,#SOHUCS #SOHU_MAIN .module-cmt-list .module-cmt-box .post-wrap-w div.post-wrap-main{border:1px solid #e6e6e6!important;border-radius:20px 20px 20px 20px;margin:0!important}#SOHUCS #SOHU_MAIN .module-cmt-box .post-wrap-w .wrap-action-w .action-issue-w .issue-btn-w a .btn-fw{width:130px!important;height:34px!important;line-height:33px!important;font-size:17px!important;background:#5483b1!important;border-radius:20px!important;color:#FFF!important;-webkit-box-shadow:0 -1px 4px #5483b1 inset;box-shadow:0 -1px 10px #5483b1 inset}#SOHUCS #SOHU_MAIN .module-cmt-box .post-wrap-w .wrap-action-w .action-issue-w .issue-btn-w a .btn-fw:before{content:"发表评论"}#SOHUCS #SOHU_MAIN .module-cmt-box .post-wrap-w .wrap-action-w .action-issue-w .issue-btn-w a:hover .btn-fw{color:#40759b!important;background:#FFF!important}#SOHUCS #SOHU_MAIN .module-cmt-list .cmt-list-type .type-lists li{background:none!important;border-bottom:1px solid #e6e6e6}#SOHUCS #SOHU_MAIN .module-cmt-list .cmt-list-type .type-lists li.active{border:1px solid #e6e6e6;border-radius:10px 10px 0 0;border-bottom:none}#SOHUCS #SOHU_MAIN .module-cmt-list .block-title-gw ul li .title-name-gw div.title-name-gw-tag{background:#5483b1!important;border-radius:3px}#SOHUCS #SOHU_MAIN .module-cmt-list .cmt-list-type div.cmt-list-border{background-color:#e6e6e6!important}#SOHUCS #SOHU_MAIN .module-cmt-notice ul.nt-list li.nt-item{border:1px solid #e6e6e6!important}#SOHUCS #SOHU_MAIN .module-cmt-notice ul.nt-list li.nt-item .nt-logo{text-align:center;line-height:40px;border-radius:50%!important;background:#e6e6e6!important}#SOHUCS #SOHU_MAIN .module-cmt-notice ul.nt-list li.nt-item .nt-logo:before{content:"畅";font-size:22px;color:#FFF}#SOHUCS #SOHU_MAIN .module-cmt-notice ul.nt-list li.nt-item a.nt-text,#SOHUCS #SOHU_MAIN .module-cmt-notice ul.nt-list li.nt-item a.nt-text i{color:#5483b1!important}#SOHUCS #SOHU_MAIN .module-cmt-header .section-title-w .title-user-w .user-wrap-w{background:#FFF!important}@media screen and (min-width:900px){#SOHUCS #SOHU_MAIN .module-mobile-cmt-list .list-wrapper-wap .list-container-wap .list-item-wap .list-content-wrapper-wap .cmt-list-image-container .cmt-list-image{max-width: 100%;}}');
  //-   }
  //- };
})();
function removeElement(_element){
     var _parentElement = _element.parentNode;
     if(_parentElement){
            _parentElement.removeChild(_element);
     }
}
var removeAD = document.createElement("div");
removeAD.id = 'removeAD';
var adInterval1 = setInterval(function() {
  if(document.querySelector("#feedAv")){
    document.querySelector("[node-type=cmt-list]").appendChild(removeAD);
    document.querySelector("#removeAD").appendChild(document.querySelector("#feedAv"));
    //- removeElement(document.querySelectorAll("#feedAv")[0]);
    var feedAv = document.querySelector("#feedAv").children;
    for( item of feedAv){
      item.style.display = 'none'
    }
    document.querySelector("#removeAD").style.display="none"
    clearInterval(adInterval1);
  }
},1000);
var adInterval2 = setInterval(function() {
  if(document.querySelector("#pop_ad")){
    removeElement(document.querySelector("#pop_ad"));
    clearInterval(adInterval2);
  }
}, 1000);</script><script src="https://assets.changyan.sohu.com/upload/plugins/plugins.count.js"></script></body></html>